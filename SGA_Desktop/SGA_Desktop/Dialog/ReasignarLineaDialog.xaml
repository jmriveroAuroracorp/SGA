<Window x:Class="SGA_Desktop.Dialog.ReasignarLineaDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:SGA_Desktop.ViewModels"
        xmlns:helpers="clr-namespace:SGA_Desktop.Helpers"
        Title="REASIGNAR LÍNEA DE CONTEO"
        Width="600"
        Height="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <!-- Recursos -->
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/SGA_Desktop;component/Resources/Estilos.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Converters -->
            <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        </ResourceDictionary>
    </Window.Resources>

    <!-- Marco principal -->
    <Border CornerRadius="8"
            Background="{StaticResource BrushFondo}"
            BorderBrush="{StaticResource BrushPrincipal}"
            BorderThickness="2">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="60"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BrushPrincipal}" 
                    CornerRadius="6,6,0,0">
                <Grid>
                    <TextBlock Text=" REASIGNAR LÍNEA DE CONTEO" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="White"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                    <!-- Botón cerrar -->
                    <Button Content="✕" 
                            Width="30" 
                            Height="30"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Margin="0,0,10,0"
                            Style="{StaticResource EstiloBotonPrincipal}"
                            Command="{Binding CancelarCommand}"
                            FontSize="14"/>
                </Grid>
            </Border>

            <!-- Contenido principal -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="20">
                <StackPanel>
                    <!-- Información del resultado actual -->
                    <GroupBox Header="📋 Información de la Línea" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <TextBlock Text="Título: " FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBlock Text="{Binding ResultadoSeleccionado.Titulo, FallbackValue='SIN TÍTULO'}" FontSize="14" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Ubicación: " FontWeight="Bold" Margin="0,10,0,5"/>
                            <TextBlock Text="{Binding ResultadoSeleccionado.CodigoUbicacion, FallbackValue='SIN UBICACIÓN'}" FontSize="12" Foreground="Gray" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Artículo: " FontWeight="Bold" Margin="0,10,0,5"/>
                            <TextBlock Text="{Binding ResultadoSeleccionado.CodigoArticulo, FallbackValue='SIN ARTÍCULO'}" FontFamily="Consolas" Margin="0,0,0,5"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Selección de nuevo operario -->
                    <GroupBox Header="👤 Nuevo Operario" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <TextBlock Text="Seleccionar operario *" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding OperariosDisponibles}"
                                      DisplayMemberPath="NombreCompleto"
                                      SelectedItem="{Binding OperarioSeleccionado}"
                                      Height="35"
                                      FontSize="14"
                                      Padding="8"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Comentario -->
                    <GroupBox Header=" Comentario" Margin="0,0,0,15">
                        <StackPanel Margin="15">
                            <TextBlock Text="Motivo de la reasignación" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Comentario, UpdateSourceTrigger=PropertyChanged}"
                                     Height="80"
                                     FontSize="14"
                                     Padding="8"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Estado de carga -->
                    <StackPanel Visibility="{Binding IsCargando, Converter={StaticResource BoolToVis}}"
                               Orientation="Horizontal"
                               Margin="0,10,0,0">
                        <ProgressBar Width="20" Height="20" 
                                     IsIndeterminate="True" 
                                     Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding MensajeEstado}" 
                                   VerticalAlignment="Center"
                                   FontStyle="Italic"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Botones de acción -->
            <Border Grid.Row="2" BorderThickness="0,1,0,0" BorderBrush="{StaticResource BrushSecundario}">
                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Center"
                           Margin="20,10">
                    <Button Content="Cancelar"
                            Command="{Binding CancelarCommand}"
                            Style="{StaticResource EstiloBotonSecundario}"
                            Width="100"
                            Height="35"
                            Margin="0,0,10,0"/>
                    <Button Content="Reasignar Línea"
                            Command="{Binding ReasignarLineaCommand}"
                            Style="{StaticResource EstiloBotonPrincipal}"
                            Width="130"
                            Height="35"
                            IsEnabled="{Binding PuedeReasignar}"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window> 