<Page x:Class="SGA_Desktop.Views.ImpresionEtiquetasView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:SGA_Desktop.ViewModels"
      xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
      Background="{StaticResource BrushFondo}"
      FontFamily="{StaticResource FuentePrincipal}">


    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 1) BÚSQUEDA -->
        <StackPanel Grid.Row="0"
                Orientation="Horizontal"
                Margin="0,0,0,16">
            <TextBox Width="250"
               Style="{StaticResource EstiloCajaTexto}"
               Text="{Binding FiltroArticulo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Content="Buscar artículo"
              Style="{StaticResource EstiloBotonPrincipal}"
              Margin="12,0,0,0"
              Command="{Binding BuscarArticuloCommand}" Cursor="" />
        </StackPanel>

        <!-- 2) LISTADO COMO TARJETAS -->
        <ListView Grid.Row="1"
          ItemsSource="{Binding Articulos}"
          SelectedItem="{Binding SelectedArticulo}"
          ScrollViewer.VerticalScrollBarVisibility="Auto"
          SelectionMode="Single">

            <!-- Estilo de tarjeta idéntico -->
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="FontFamily" Value="{StaticResource FuentePrincipal}"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="MinHeight" Value="80"/>
                    <Setter Property="Margin" Value="0,0,0,10"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="Black"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                BorderThickness="1"
                                BorderBrush="{StaticResource BrushPrincipal}">
                                    <ContentPresenter />
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#10CCCCCC"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="{StaticResource BrushSecundario1}"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListView.ItemContainerStyle>

            <!-- Template de tarjeta replicado -->
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="80"/>
                        </Grid.ColumnDefinitions>

                        <!-- Código Artículo -->
                        <TextBlock Grid.Column="0"
                           Text="{Binding CodigoArticulo}"
                           FontWeight="Bold"
                           FontSize="20"
                           Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"
                           VerticalAlignment="Center"
                           TextAlignment="Center"/>

                        <!-- Artículo y almacén -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="{Binding DescripcionArticulo}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"/>
                            <TextBlock>
                        <Run Text="{Binding CodigoAlmacen}"/>
                        <Run Text=" – "/>
                        <Run Text="{Binding Almacen}"/>
                            </TextBlock>
                        </StackPanel>

                        <!-- Ubicación / Partida -->
                        <StackPanel Grid.Column="2" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Ubicacion, StringFormat='Ubicación: {0}'}"
                               FontSize="14"
                               Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"/>
                            <TextBlock Text="{Binding Partida, StringFormat='Partida: {0}'}"
                               FontSize="14"
                               Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"/>
                        </StackPanel>

                        <!-- Saldo -->
                        <TextBlock Grid.Column="3"
                           Text="{Binding UnidadSaldo, StringFormat=F4}"
                           FontSize="16"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           TextAlignment="Right"
                           Margin="8,0,0,0"
                           Foreground="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=Foreground}"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>


        <!-- 3) BOTÓN IMPRIMIR -->
        <StackPanel
    Grid.Row="2"
    Orientation="Horizontal"
    HorizontalAlignment="Right"
    VerticalAlignment="Center"
    Margin="0,16,0,0">

            <!-- Etiqueta Impresora -->
            <TextBlock
      Text="Impresora:"
      VerticalAlignment="Center"
      Margin="0,0,4,0"/>

            <!-- Combo de impresoras -->
            <ComboBox
      Width="200"
      ItemsSource="{Binding Impresoras}"
      SelectedItem="{Binding ImpresoraSeleccionada}"
      DisplayMemberPath="Nombre"
      Style="{StaticResource EstiloComboBox}"
      Margin="0,0,16,0"/>

            <!-- Etiqueta Copias -->
            <TextBlock
      Text="Copias:"
      VerticalAlignment="Center"
      Margin="0,0,4,0"/>

            <!-- TextBox Número de copias -->
            <xctk:IntegerUpDown
    Width="60"
    Minimum="1"
    Value="{Binding NumeroCopias, Mode=TwoWay}"

    Margin="0,0,16,0"/>

            <!-- Botón Imprimir -->
            <Button
      Content="Imprimir etiqueta"
      Style="{StaticResource EstiloBotonPrincipal}"
      Width="140"
      Height="36"
      Command="{Binding ImprimirEtiquetaCommand}"
      IsEnabled="{Binding CanImprimir}" />
        </StackPanel>
    </Grid>
</Page>
