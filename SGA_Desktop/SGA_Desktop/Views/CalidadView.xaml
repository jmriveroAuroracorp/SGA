<Page x:Class="SGA_Desktop.Views.CalidadView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SGA_Desktop.Views"
             xmlns:helpers="clr-namespace:SGA_Desktop.Helpers"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="{StaticResource BrushFondo}">
    
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/SGA_Desktop;component/Resources/Estilos.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <helpers:OperarioIdANombreConverter x:Key="OperarioIdANombreConverter"/>
        </ResourceDictionary>
    </Page.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>


        <!-- BARRA DE BÚSQUEDA (Solo visible en pestaña Stock) -->
        <Border Grid.Row="0" 
                Background="White"
                Padding="20,15"
                BorderBrush="{StaticResource BrushPrincipal}"
                BorderThickness="2"
                CornerRadius="8"
                Margin="0,0,0,10"
                Visibility="{Binding MostrandoStock, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Título de la sección -->
                <TextBlock Grid.Row="0" 
                           Text="📋 Criterios de Búsqueda"
                           FontFamily="{StaticResource FuentePrincipal}"
                           FontSize="16"
                           FontWeight="Bold"
                           Foreground="{StaticResource BrushPrincipal}"
                           Margin="0,0,0,12"/>
                
                <!-- Campos de búsqueda -->
                <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                    <StackPanel Grid.Column="0" Margin="0,0,20,0">
                    <TextBlock Text="Código de Artículo" 
                               FontFamily="{StaticResource FuentePrincipal}"
                                   FontSize="13"
                               FontWeight="Bold"
                                   Foreground="{StaticResource BrushPrincipal}"
                                   Margin="0,0,0,8"/>
                    <TextBox Text="{Binding CodigoArticulo}" 
                                 Style="{StaticResource EstiloCajaTexto}"
                                 Height="35"/>
                </StackPanel>
                
                    <StackPanel Grid.Column="1" Margin="20,0">
                    <TextBlock Text="Lote/Partida" 
                               FontFamily="{StaticResource FuentePrincipal}"
                                   FontSize="13"
                               FontWeight="Bold"
                                   Foreground="{StaticResource BrushPrincipal}"
                                   Margin="0,0,0,8"/>
                    <TextBox Text="{Binding LotePartida}" 
                                 Style="{StaticResource EstiloCajaTexto}"
                                 Height="35"/>
                </StackPanel>
                
                    <StackPanel Grid.Column="2" Margin="20,0">
                    <TextBlock Text="Almacén (Opcional)" 
                               FontFamily="{StaticResource FuentePrincipal}"
                                   FontSize="13"
                               FontWeight="Bold"
                                   Foreground="{StaticResource BrushPrincipal}"
                                   Margin="0,0,0,8"/>
                    <TextBox Text="{Binding CodigoAlmacen}" 
                                 Style="{StaticResource EstiloCajaTexto}"
                                 Height="35"/>
                </StackPanel>
                
                    <StackPanel Grid.Column="3" Margin="20,0">
                    <TextBlock Text="Ubicación (Opcional)" 
                               FontFamily="{StaticResource FuentePrincipal}"
                                   FontSize="13"
                               FontWeight="Bold"
                                   Foreground="{StaticResource BrushPrincipal}"
                                   Margin="0,0,0,8"/>
                    <TextBox Text="{Binding CodigoUbicacion}" 
                                 Style="{StaticResource EstiloCajaTexto}"
                                 Height="35"/>
                </StackPanel>
                
                    <StackPanel Grid.Column="4" Margin="25,0" VerticalAlignment="Bottom">
                        <Button Content="🔍 Buscar Stock" 
                            Command="{Binding BuscarStockCommand}"
                            Style="{StaticResource EstiloBotonPrincipal}"
                                Width="120"
                                Height="40"
                                Margin="0,0,0,8"/>
                    <Button Content="🗑️ Limpiar" 
                            Command="{Binding LimpiarBusquedaCommand}"
                            Style="{StaticResource EstiloBotonSecundario}"
                                Width="120"
                                Height="35"/>
                </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- BOTONES DE PESTAÑAS -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="📦 Stock Disponible"
                    Command="{Binding CambiarAStockCommand}"
                    Width="180"
                    Height="35"
                    Margin="0,0,8,0">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource EstiloBoton}">
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="BorderBrush" Value="{StaticResource BrushPrincipal}"/>
                        <Setter Property="Foreground" Value="{StaticResource BrushPrincipal}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding MostrandoStock}" Value="True">
                                <Setter Property="Background" Value="{StaticResource BrushPrincipal}"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="🔒 Bloqueos"
                    Command="{Binding CambiarABloqueosCommand}"
                    Width="160"
                    Height="35">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource EstiloBoton}">
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="BorderBrush" Value="{StaticResource BrushPrincipal}"/>
                        <Setter Property="Foreground" Value="{StaticResource BrushPrincipal}"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding MostrandoBloqueos}" Value="True">
                                <Setter Property="Background" Value="{StaticResource BrushPrincipal}"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <!-- CONTENIDO DE STOCK DISPONIBLE -->
        <Grid Grid.Row="2"
              Visibility="{Binding MostrandoStock, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- ListView de Stock con Cards -->
                    <ListView Grid.Row="0"
                              ItemsSource="{Binding StockDisponible}"
                              SelectedItem="{Binding StockSeleccionado}"
                              SelectionMode="Single"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              Background="Transparent">
                        
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="FontFamily" Value="{StaticResource FuentePrincipal}"/>
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Margin" Value="0,0,0,10"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="Black"/>
                            </Style>
                        </ListView.ItemContainerStyle>

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border CornerRadius="8"
                                        BorderThickness="2"
                                        BorderBrush="{StaticResource BrushPrincipal}"
                                        Background="White"
                                        Margin="0,0,0,12"
                                        Effect="{x:Null}">
                                    
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="White"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource BrushPrincipal}"/>
                                            <Style.Triggers>
                                                <!-- Hover -->
                                                <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=ListViewItem}}" Value="True">
                                                    <Setter Property="Background" Value="#F8FBFF"/>
                                                    <Setter Property="BorderBrush" Value="{StaticResource BrushSecundario1}"/>
                                                </DataTrigger>
                                                <!-- Selección -->
                                                <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListViewItem}}" Value="True">
                                                    <Setter Property="Background" Value="#E8F4FD"/>
                                                    <Setter Property="BorderBrush" Value="{StaticResource BrushSecundario1}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>

                                    <Grid Margin="12,10">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Header con código y descripción -->
                                        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,8">
                                            <Border Background="{StaticResource BrushPrincipal}" 
                                                    CornerRadius="4" 
                                                    Padding="8,4" 
                                                    Margin="0,0,12,0">
                                            <TextBlock Text="{Binding CodigoArticulo}"
                                                       FontWeight="Bold"
                                                           FontSize="14"
                                                           Foreground="White"/>
                                            </Border>
                                            <TextBlock Text="{Binding DescripcionArticulo}"
                                                       FontSize="13"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource BrushPrincipal}"
                                                       VerticalAlignment="Center"
                                                       MaxWidth="280"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>

                                        <!-- Información de ubicación y lote -->
                                        <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,8" 
                                                    ScrollViewer.HorizontalScrollBarVisibility="Auto">
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="6,3" 
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="🏢" FontSize="11" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding Almacen}" 
                                                               FontWeight="Bold" 
                                                               FontSize="11"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="6,3" 
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="📍" FontSize="11" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding Ubicacion}" 
                                                               FontWeight="Bold" 
                                                               FontSize="11"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="6,3" 
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="🏷️" FontSize="11" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding LotePartida}" 
                                                               FontWeight="Bold" 
                                                               FontSize="11"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="6,3">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="📅" FontSize="11" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding FechaCaducidad, StringFormat=dd/MM/yyyy}" 
                                                               FontWeight="Bold" 
                                                               FontSize="11"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>

                                        <!-- Información de cantidad y estado -->
                                        <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Margin="0,4,0,0">
                                            <Border Background="#F0F6FF" 
                                                    CornerRadius="3" 
                                                    Padding="6,3" 
                                                    Margin="0,0,8,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="📦" FontSize="11" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding CantidadDisponible, StringFormat=F4}" 
                                                       FontWeight="Bold" 
                                                               FontSize="11"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border CornerRadius="3" 
                                                    Padding="6,3">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="#FFE6E6"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Estado}" Value="Disponible">
                                                                <Setter Property="Background" Value="#E6F7E6"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Estado}" Value="Bloqueado">
                                                                <Setter Property="Background" Value="#FFE6E6"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Estado}" Value="Collapsed">
                                                                <Setter Property="Background" Value="#FFF4E6"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="⚡" FontSize="11" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding Estado}" 
                                                               FontWeight="Bold" 
                                                               FontSize="11">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Foreground" Value="#CC0000"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Estado}" Value="Disponible">
                                                                        <Setter Property="Foreground" Value="#006600"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Estado}" Value="Bloqueado">
                                                                        <Setter Property="Foreground" Value="#CC0000"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Estado}" Value="Collapsed">
                                                                        <Setter Property="Foreground" Value="#CC6600"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>

                                        <!-- Cantidad destacada a la derecha -->
                                        <Border Grid.Row="0" Grid.RowSpan="3" Grid.Column="1"
                                                Background="{StaticResource BrushSecundario1}"
                                                CornerRadius="6"
                                                Padding="12,8"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                MinWidth="100">
                                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                                <TextBlock Text="STOCK" 
                                                           FontWeight="Bold" 
                                                           Foreground="White" 
                                                           FontSize="9"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,3"/>
                                                <TextBlock Text="{Binding CantidadDisponible, StringFormat=F4}"  
                                                           FontWeight="Bold" 
                                                           FontSize="18"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Panel de Bloqueo -->
                    <Border Grid.Row="1" 
                            Background="White"
                            Padding="15"
                            Margin="0,10,0,0"
                            BorderBrush="{StaticResource BrushPrincipal}"
                            BorderThickness="2"
                            CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Título de la sección -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <TextBlock Text="🔒" FontSize="16" Margin="0,0,6,0"/>
                                <TextBlock Text="BLOQUEAR STOCK SELECCIONADO" 
                                           FontFamily="{StaticResource FuentePrincipal}"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           Foreground="{StaticResource BrushPrincipal}"/>
                            </StackPanel>

                            <!-- Contenido del panel -->
                            <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                    <TextBlock Text="Motivo del Bloqueo" 
                                           FontFamily="{StaticResource FuentePrincipal}"
                                           FontWeight="Bold"
                                               FontSize="13"
                                               Foreground="{StaticResource BrushPrincipal}"
                                               Margin="0,0,0,6"/>
                                <TextBox Text="{Binding ComentarioBloqueo}" 
                                             Height="50" 
                                         TextWrapping="Wrap" 
                                         AcceptsReturn="True"
                                             Style="{StaticResource EstiloCajaTexto}"
                                             FontSize="13"
                                             Padding="10"/>
                                    <TextBlock Text="💡 Especifica el motivo del bloqueo para control de calidad"
                                               FontFamily="{StaticResource FuentePrincipal}"
                                               FontSize="10"
                                               FontStyle="Italic"
                                               Foreground="#666"
                                               Margin="0,3,0,0"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" VerticalAlignment="Bottom">
                                    <Button Content="🔒 BLOQUEAR" 
                                        Command="{Binding BloquearStockCommand}" 
                                        Style="{StaticResource EstiloBotonPrincipal}"
                                            Width="120" 
                                            Height="35" 
                                            FontSize="13"
                                            FontWeight="Bold"
                                            Margin="0,0,0,8"/>
                                <Button Content="🗑️ Limpiar" 
                                        Command="{Binding LimpiarComentariosCommand}" 
                                        Style="{StaticResource EstiloBotonSecundario}"
                                            Width="120" 
                                            Height="35"
                                            FontSize="12"/>
                            </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
        </Grid>

        <!-- CONTENIDO DE BLOQUEOS -->
        <Grid Grid.Row="2"
              Visibility="{Binding MostrandoBloqueos, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Filtros de Bloqueos -->
                    <Border Grid.Row="0" 
                            Background="White"
                            Padding="20,15"
                            Margin="0,0,0,10"
                            BorderBrush="{StaticResource BrushPrincipal}"
                            BorderThickness="2"
                            CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Título -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                                <TextBlock Text="📋" FontSize="16" Margin="0,0,6,0"/>
                                <TextBlock Text="Filtros de Bloqueos" 
                                           FontFamily="{StaticResource FuentePrincipal}"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource BrushPrincipal}"/>
                            </StackPanel>

                            <!-- Contenido de filtros -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Código de Artículo -->
                                <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                    <TextBlock Text="Código de Artículo" 
                                               FontFamily="{StaticResource FuentePrincipal}"
                                               FontSize="12"
                                               Foreground="{StaticResource BrushGrisOscuro}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FiltroCodigoArticulo, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource EstiloCajaTexto}"
                                             Height="35"/>
                                </StackPanel>

                                <!-- Lote/Partida -->
                                <StackPanel Grid.Column="1" Margin="0,0,15,0">
                                    <TextBlock Text="Lote/Partida" 
                                               FontFamily="{StaticResource FuentePrincipal}"
                                               FontSize="12"
                                               Foreground="{StaticResource BrushGrisOscuro}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FiltroLotePartida, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource EstiloCajaTexto}"
                                             Height="35"/>
                                </StackPanel>

                                <!-- Almacén -->
                                <StackPanel Grid.Column="2" Margin="0,0,15,0">
                                    <TextBlock Text="Almacén (Opcional)" 
                                               FontFamily="{StaticResource FuentePrincipal}"
                                               FontSize="12"
                                               Foreground="{StaticResource BrushGrisOscuro}"
                                               Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding FiltroAlmacen, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource EstiloCajaTexto}"
                                             Height="35"/>
                                </StackPanel>

                                <!-- Checkbox Solo Bloqueados -->
                                <StackPanel Grid.Column="3" Margin="0,20,15,0" VerticalAlignment="Center">
                                    <CheckBox Content="Solo Bloqueados" 
                                              IsChecked="{Binding MostrarSoloBloqueados}" 
                                              FontFamily="{StaticResource FuentePrincipal}"
                                              FontWeight="Bold"
                                              Foreground="{StaticResource BrushPrincipal}"/>
                                </StackPanel>

                                <!-- Botones -->
                                <StackPanel Grid.Column="4" VerticalAlignment="Bottom" Margin="0,0,10,0">
                                    <Button Content="🔍 Filtrar" 
                                            Command="{Binding FiltrarBloqueosCommand}" 
                                            Style="{StaticResource EstiloBotonPrincipal}"
                                            Width="120" 
                                            Height="35"
                                            Margin="0,0,0,8"/>
                                    <Button Content="🗑️ Limpiar" 
                                            Command="{Binding LimpiarFiltrosBloqueosCommand}" 
                                            Style="{StaticResource EstiloBotonSecundario}"
                                            Width="120" 
                                            Height="35"/>
                                </StackPanel>

                                <!-- Botón Actualizar -->
                                <StackPanel Grid.Column="5" VerticalAlignment="Bottom">
                                    <Button Content="🔄 Actualizar" 
                                            Command="{Binding CargarBloqueosCommand}" 
                                            Style="{StaticResource EstiloBotonPrincipal}"
                                            Width="120" 
                                            Height="35"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- ListView de Bloqueos con Cards -->
                    <ListView Grid.Row="1"
                              ItemsSource="{Binding BloqueosFiltrados}"
                              SelectedItem="{Binding BloqueoSeleccionado}"
                              SelectionMode="Single"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              Background="Transparent">
                        
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="FontFamily" Value="{StaticResource FuentePrincipal}"/>
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Margin" Value="0,0,0,10"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="Black"/>
                            </Style>
                        </ListView.ItemContainerStyle>

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Border CornerRadius="8"
                                        BorderThickness="2"
                                        BorderBrush="{StaticResource BrushPrincipal}"
                                        Background="White"
                                        Margin="0,0,0,12">
                                    
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="White"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource BrushPrincipal}"/>
                                            <Style.Triggers>
                                                <!-- Hover -->
                                                <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=ListViewItem}}" Value="True">
                                                    <Setter Property="Background" Value="#F8FBFF"/>
                                                    <Setter Property="BorderBrush" Value="{StaticResource BrushSecundario1}"/>
                                                </DataTrigger>
                                                <!-- Selección -->
                                                <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListViewItem}}" Value="True">
                                                    <Setter Property="Background" Value="#E8F4FD"/>
                                                    <Setter Property="BorderBrush" Value="{StaticResource BrushSecundario1}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>

                                    <Grid Margin="10,8">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Header con código y descripción -->
                                        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,6">
                                            <Border Background="{StaticResource BrushPrincipal}" 
                                                    CornerRadius="3" 
                                                    Padding="6,3" 
                                                    Margin="0,0,8,0">
                                            <TextBlock Text="{Binding CodigoArticulo}"
                                                       FontWeight="Bold"
                                                           FontSize="13"
                                                           Foreground="White"/>
                                            </Border>
                                            <TextBlock Text="{Binding DescripcionArticulo}"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource BrushPrincipal}"
                                                       VerticalAlignment="Center"
                                                       MaxWidth="250"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>

                                        <!-- Información de ubicación -->
                                        <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,6"
                                                    ScrollViewer.HorizontalScrollBarVisibility="Auto">
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="5,2" 
                                                    Margin="0,0,6,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="🏷️" FontSize="10" Margin="0,0,3,0"/>
                                                    <TextBlock Text="{Binding LotePartida}" 
                                                               FontWeight="Bold" 
                                                               FontSize="10"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="5,2" 
                                                    Margin="0,0,6,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="🏢" FontSize="10" Margin="0,0,3,0"/>
                                                    <TextBlock Text="{Binding Almacen}" 
                                                               FontWeight="Bold" 
                                                               FontSize="10"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#E8F4FD" 
                                                    CornerRadius="3" 
                                                    Padding="5,2">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="📍" FontSize="10" Margin="0,0,3,0"/>
                                                    <TextBlock Text="{Binding Ubicacion}" 
                                                               FontWeight="Bold" 
                                                               FontSize="10"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>

                                        <!-- Información de bloqueo -->
                                        <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,0">
                                            <Border Background="#F0F6FF" 
                                                    CornerRadius="4" 
                                                    Padding="8,4" 
                                                    Margin="0,0,10,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="👤" FontSize="13" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding UsuarioBloqueo, Converter={StaticResource OperarioIdANombreConverter}}" 
                                                               FontWeight="Bold" 
                                                               FontSize="13"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                                </StackPanel>
                                            </Border>
                                            <Border Background="#F0F6FF" 
                                                    CornerRadius="4" 
                                                    Padding="8,4">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="🕐" FontSize="13" Margin="0,0,4,0"/>
                                                    <TextBlock Text="{Binding FechaBloqueo, StringFormat=dd/MM/yyyy HH:mm}" 
                                                       FontWeight="Bold" 
                                                               FontSize="13"
                                                               Foreground="{StaticResource BrushPrincipal}"/>
                                        </StackPanel>
                                            </Border>
                                        </StackPanel>


                                        <!-- Estado destacado a la derecha -->
                                        <Border Grid.Row="0" Grid.RowSpan="3" Grid.Column="1"
                                                CornerRadius="6"
                                                Padding="10,6"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                MinWidth="80">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#DC3545"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Bloqueado}" Value="False">
                                                            <Setter Property="Background" Value="#28A745"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                                                <TextBlock Text="ESTADO" 
                                                           FontWeight="Bold" 
                                                           Foreground="White" 
                                                           FontSize="9"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,0,0,2"/>
                                                <TextBlock FontWeight="Bold" 
                                                           FontSize="14"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="BLOQUEADO"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Bloqueado}" Value="False">
                                                                    <Setter Property="Text" Value="DESBLOQUEADO"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Panel de Desbloqueo -->
                    <Border Grid.Row="2" 
                            Background="White"
                            Padding="15"
                            Margin="0,10,0,0"
                            BorderBrush="{StaticResource BrushPrincipal}"
                            BorderThickness="2"
                            CornerRadius="8">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Título de la sección -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <TextBlock Text="🔓" FontSize="16" Margin="0,0,6,0"/>
                                <TextBlock Text="DESBLOQUEAR STOCK SELECCIONADO" 
                                           FontFamily="{StaticResource FuentePrincipal}"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           Foreground="{StaticResource BrushPrincipal}"/>
                            </StackPanel>

                            <!-- Contenido del panel -->
                            <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                    <TextBlock Text="Motivo del Desbloqueo" 
                                           FontFamily="{StaticResource FuentePrincipal}"
                                           FontWeight="Bold"
                                               FontSize="13"
                                               Foreground="{StaticResource BrushPrincipal}"
                                               Margin="0,0,0,6"/>
                                <TextBox Text="{Binding ComentarioDesbloqueo}" 
                                             Height="50" 
                                         TextWrapping="Wrap" 
                                         AcceptsReturn="True"
                                             Style="{StaticResource EstiloCajaTexto}"
                                             FontSize="13"
                                             Padding="10"/>
                                    <TextBlock Text="💡 Explica por qué se libera este stock del control de calidad"
                                               FontFamily="{StaticResource FuentePrincipal}"
                                               FontSize="10"
                                               FontStyle="Italic"
                                               Foreground="#666"
                                               Margin="0,3,0,0"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" VerticalAlignment="Bottom">
                                    <Button Content="🔓 DESBLOQUEAR" 
                                        Command="{Binding DesbloquearStockCommand}" 
                                        Style="{StaticResource EstiloBotonPrincipal}"
                                            Width="120" 
                                            Height="35" 
                                            FontSize="13"
                                            Margin="0,0,0,8"/>
                                <Button Content="🗑️ Limpiar" 
                                        Command="{Binding LimpiarComentariosCommand}" 
                                        Style="{StaticResource EstiloBotonSecundario}"
                                            Width="120" 
                                            Height="35"
                                            FontSize="12"/>
                            </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
        </Grid>

        <!-- BARRA DE ESTADO -->
        <Border Grid.Row="3" 
                Height="40"
                Background="White"
                BorderBrush="{StaticResource BrushPrincipal}"
                BorderThickness="0,2,0,0"
                CornerRadius="0,0,8,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" 
                            Orientation="Horizontal" 
                            VerticalAlignment="Center" 
                            Margin="15,0">
                    <TextBlock Text="📊" FontSize="14" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding MensajeEstado}" 
                           FontFamily="{StaticResource FuentePrincipal}"
                               FontSize="12"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource BrushPrincipal}"
                               VerticalAlignment="Center"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            VerticalAlignment="Center" 
                            Margin="0,0,15,0">
                    <ProgressBar Width="120" 
                                 Height="20" 
                            IsIndeterminate="{Binding EstaCargando}" 
                                 Visibility="{Binding EstaCargando, Converter={StaticResource BooleanToVisibilityConverter}}"
                                 Background="#E0E0E0"
                                 Foreground="{StaticResource BrushPrincipal}"
                                 Margin="0,0,10,0"/>
                    <TextBlock Text="🔄 Cargando..." 
                               FontFamily="{StaticResource FuentePrincipal}"
                               FontSize="11"
                               Foreground="#666"
                               VerticalAlignment="Center"
                            Visibility="{Binding EstaCargando, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>